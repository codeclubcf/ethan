<frameset rows="65%,35%" framespacing="1" frameborder="yes" border="1" bordercolor="#FF0000">
    <frame src="messages.php" name="main_frame">
    <frame src="main.php" name="login_frame" scrolling="no" noresize target="middle">
</frameset>
<link type="text/css" rel="stylesheet" href="styles.css" />
<form class="login_form" method="post" action="main.php">
 <div>Username: <input type="text" name="username" /></div>
 <div>Password: <input type="password" name="password" /></div>
 <div><input type="submit" value="Login" name="Login" /></div>
</form>
<div>You can use username "User1" or "User2" or "User3" and password "qwerty" to login in system</div>
<link type="text/css" rel="stylesheet" href="styles.css" />
<div class="chat_main">
 <h3>Chat</h3>
</div>
<link type="text/css" rel="stylesheet" href="styles.css" />
<form class="submit_form" method="post" action="main.php">
 <div><input type="text" name="s_message" /><input type="submit" value="Say" name="s_say" /></div>
</form>
<div>You can type anything in chat</div>
login_form {
02
 border: 1px solid #AAA;
03
 padding:10px;
04
}
05
 
06
h3 {margin-top:3px;}
07
 
08
.chat_main {
09
 border:1px solid #AAA;
10
 -moz-box-shadow:0 0 10px #ccc;
11
 -webkit-box-shadow: 0 0 10px #ccc;
12
 width:350px;
13
 padding:10px;
14
 background:#f3f3f3;
15
}
16
 
17
.message {
18
 border:1px solid #AAA;
19
 margin:4px;
20
 padding:5px;
21
 -moz-border-radius:7px;
22
 -webkit-border-radius:7px;
23
 background:#ffffff;
24
}
25
 
26
.textf {
27
-moz-box-shadow:0 0 10px #CCCCCC;
28
-webkit-box-shadow:0 0 10px #CCCCCC;
29
border:1px solid #CCCCCC;
30
height:40px;
31
}
.submit {
-moz-border-radius:7px;
-webkit-border-radius:7px;
background:#F3F3F3;
border:1px solid #CCCCCC;
font-size:16px;
font-weight:bold;
height:35px;
margin-left:10px;
padding:5px;
}
.message span {
 font-size:10px;
 color:#888;
 margin-left:10px;
}
.submit_form {
 margin:10px 0px;
}
CREATE TABLE `s_chat_messages` (
2
`id` INT(11) NOT NULL AUTO_INCREMENT ,
3
`user` VARCHAR(255) NOT NULL ,
4
`message` VARCHAR(255) NOT NULL ,
5
`when` INT(11) NOT NULL ,
6
PRIMARY KEY (`id`)
7
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
<?php
02
 
03
// set error reporting level
04
if (version_compare(phpversion(), "5.3.0", ">=") == 1)
05
 error_reporting(E_ALL & ~E_NOTICE & ~E_DEPRECATED);
06
else
07
 error_reporting(E_ALL & ~E_NOTICE);
08
 
09
require_once('inc/login.inc.php');
10
require_once('inc/chat.inc.php');
11
 
12
// initialization of login system and generation code
13
$oSimpleLoginSystem = new SimpleLoginSystem();
14
 
15
$oSimpleChat = new SimpleChat();
16
 
17
// draw login box
18
echo $oSimpleLoginSystem->getLoginBox();
19
 
20
// draw chat application
21
$sChatResult = 'Need login before using';
22
if ($_COOKIE['member_name'] && $_COOKIE['member_pass']) {
23
 if ($oSimpleLoginSystem->check_login($_COOKIE['member_name'], $_COOKIE['member_pass'])) {
24
 $sChatResult = $oSimpleChat->acceptMessages();
25
 }
26
}
27
echo $sChatResult;
28
 
29
?>
<meta http-equiv="refresh" content="5">
2
<?php
3
 
4
<?php
02
 
03
// simple chat class
04
class SimpleChat {
05
 
06
    // DB variables
07
    var $sDbName;
08
    var $sDbUser;
09
    var $sDbPass;
10
 
11
    // constructor
12
    function SimpleChat() {
13
        //mysql_connect("localhost","username","password");
14
        $this->sDbName = 'database_name';
15
        $this->sDbUser = 'username';
16
        $this->sDbPass = 'password';
17
    }
18
 
19
    // adding to DB table posted message
20
    function acceptMessages() {
21
        if ($_COOKIE['member_name']) {
22
            if(isset($_POST['s_say']) && $_POST['s_message']) {
23
                $sUsername = $_COOKIE['member_name'];
24
 
25
                //the host, name, and password for your mysql
26
                $vLink = mysql_connect("localhost", $this->sDbUser, $this->sDbPass);
27
 
28
                //select the database
29
                mysql_select_db($this->sDbName);
30
 
31
                $sMessage = mysql_real_escape_string($_POST['s_message']);
32
                if ($sMessage != '') {
33
                    mysql_query("INSERT INTO `s_chat_messages` SET `user`='{$sUsername}', `message`='{$sMessage}', `when`=UNIX_TIMESTAMP()");
34
                }
35
 
36
                mysql_close($vLink);
37
            }
38
        }
39
 
40
        ob_start();
41
        require_once('chat_input.html');
42
        $sShoutboxForm = ob_get_clean();
43
 
44
        return $sShoutboxForm;
45
    }
46
 
47
    function getMessages() {
48
        $vLink = mysql_connect("localhost", $this->sDbUser, $this->sDbPass);
49
 
50
        //select the database
51
        mysql_select_db($this->sDbName);
52
 
53
        //returning the last 15 messages
54
        $vRes = mysql_query("SELECT * FROM `s_chat_messages` ORDER BY `id` ASC LIMIT 15");
55
 
56
        $sMessages = '';
57
 
58
        // collecting list of messages
59
        if ($vRes) {
60
            while($aMessages = mysql_fetch_array($vRes)) {
61
                $sWhen = date("H:i:s", $aMessages['when']);
62
                $sMessages .= '<div class="message">' . $aMessages['user'] . ': ' . $aMessages['message'] . '<span>(' . $sWhen . ')</span></div>';
63
            }
64
        } else {
65
            $sMessages = 'DB error, create SQL table before';
66
        }
67
 
68
        mysql_close($vLink);
69
 
70
        ob_start();
71
        require_once('chat_begin.html');
72
        echo $sMessages;
73
        require_once('chat_end.html');
74
        return ob_get_clean();
75
    }
76
}
77
 
78
?>
<?
02
 
03
// class SimpleLoginSystem
04
class SimpleLoginSystem {
05
 
06
    // variables
07
    var $aExistedMembers; // Existed members array
08
 
09
    // constructor
10
    function SimpleLoginSystem() {
11
        $this->aExistedMembers = array(
12
            'User1' => 'd8578edf8458ce06fbc5bb76a58c5ca4',
13
            'User2' => 'd8578edf8458ce06fbc5bb76a58c5ca4',
14
            'User3' => 'd8578edf8458ce06fbc5bb76a58c5ca4'
15
        );
16
    }
17
 
18
    function getLoginBox() {
19
        ob_start();
20
        require_once('login_form.html');
21
        $sLoginForm = ob_get_clean();
22
 
23
        $sLogoutForm = '<a href="'.$_SERVER['PHP_SELF'].'?logout=1">logout</a>';
24
 
25
        if ((int)$_REQUEST['logout'] == 1) {
26
            if (isset($_COOKIE['member_name']) && isset($_COOKIE['member_pass']))
27
                $this->simple_logout();
28
        }
29
 
30
        if ($_REQUEST['username'] && $_REQUEST['password']) {
31
            if ($this->check_login($_REQUEST['username'], MD5($_REQUEST['password']))) {
32
                $this->simple_login($_REQUEST['username'], $_REQUEST['password']);
33
                return 'Hello ' . $_REQUEST['username'] . '! ' . $sLogoutForm;
34
            } else {
35
                return 'Username or Password is incorrect' . $sLoginForm;
36
            }
37
        } else {
38
            if ($_COOKIE['member_name'] && $_COOKIE['member_pass']) {
39
                if ($this->check_login($_COOKIE['member_name'], $_COOKIE['member_pass'])) {
40
                    return 'Hello ' . $_COOKIE['member_name'] . '! ' . $sLogoutForm;
41
                }
42
            }
43
            return $sLoginForm;
44
        }
45
    }
46
 
47
    function simple_login($sName, $sPass) {
48
        $this->simple_logout();
49
 
50
        $sMd5Password = MD5($sPass);
51
 
52
        $iCookieTime = time() + 24*60*60*30;
53
        setcookie("member_name", $sName, $iCookieTime, '/');
54
        $_COOKIE['member_name'] = $sName;
55
        setcookie("member_pass", $sMd5Password, $iCookieTime, '/');
56
        $_COOKIE['member_pass'] = $sMd5Password;
57
    }
58
 
59
    function simple_logout() {
60
        setcookie('member_name', '', time() - 96 * 3600, '/');
61
        setcookie('member_pass', '', time() - 96 * 3600, '/');
62
 
63
        unset($_COOKIE['member_name']);
64
        unset($_COOKIE['member_pass']);
65
    }
66
 
67
    function check_login($sName, $sPass) {
68
        return ($this->aExistedMembers[$sName] == $sPass);
69
    }
70
}
71
 
72
?>
